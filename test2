getgenv().LvlFarm = true

local TeleportCheck = false
local KeepInfYield = true -- Установите это значение в true, если хотите сохранить Infinite Yield после телепортации
game:GetService("Players").LocalPlayer.OnTeleport:Connect(function(State)
    if KeepInfYield and not TeleportCheck and queueonteleport then
        TeleportCheck = true
        queueonteleport("loadstring(game:HttpGet('https://raw.githubusercontent.com/Mixplaylikeencoder/Games/refs/heads/main/test2'))()")
        print("Скрипт Infinite Yield добавлен в очередь телепортации.")
    end
end)

if getgenv().LvlFarm then
    -- Кэшируем необходимые сервисы и объекты
    local TeleportService = game:GetService("TeleportService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Players = game:GetService("Players")
    local VirtualInputManager = game:GetService("VirtualInputManager")
    local Workspace = game:GetService("Workspace")
    local Player = Players.LocalPlayer

    -- Убеждаемся, что персонаж загружен
    local Character = Player.Character or Player.CharacterAdded:Wait()
    local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
    local PlayerGui = Player:WaitForChild("PlayerGui")

    if game.PlaceId == 10450270085 then
        print("PlaceId 10450270085 обнаружен. Телепортируюсь в PlaceId 119359147980471.")
        repeat task.wait() until game:IsLoaded()
        TeleportService:Teleport(119359147980471, Player)
        
    elseif game.PlaceId == 119359147980471 then
        print("PlaceId 119359147980471 обнаружен. Устанавливаю уровень на math.huge и создаю лобби.")
        repeat task.wait() until game:IsLoaded()
        local replicatedData = Player:FindFirstChild("ReplicatedData")
        if replicatedData and replicatedData:FindFirstChild("level") then
            replicatedData.level.Value = math.huge
            print("Уровень установлен на math.huge.")
        else
            print("ReplicatedData или level не найдены.")
        end
        local ohString1 = "Boss"
        local ohString2 = "Heian Imaginary Demon"
        local ohString3 = "Nightmare"
        local ohString4 = ""
        ReplicatedStorage.Remotes.Server.Raids.CreateLobby:InvokeServer(ohString1, ohString2, ohString3, ohString4)
        print("Лобби создано.")
        task.wait(1)
        ReplicatedStorage.Remotes.Server.Raids.StartLobby:InvokeServer(ohString1)
        print("Лобби запущено.")
        
    elseif game.PlaceId == 16379688837 then
        print("PlaceId 16379688837 обнаружен. Запускаю задачи фарминга.")
        
        -- Функция для нажатия кнопки Replay
        local function pressReplay()
            print("Функция pressReplay запущена.")
            while getgenv().LvlFarm do
                local ReadyScreen = PlayerGui:FindFirstChild("ReadyScreen")
                if ReadyScreen and ReadyScreen.Enabled then
                    local xi = ReadyScreen:FindFirstChild("Frame")
                    local ReplayButton = xi:FindFirstChild("Replay")
                    if ReplayButton and ReplayButton:IsA("GuiButton") then
                        print("Нахожу кнопку Replay. Пытаюсь нажать.")
                        -- Если предыдущие методы не сработали, используем VirtualInputManager
                        print("Пробую нажать Replay через VirtualInputManager.")
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.BackSlash, false, game)
                        task.wait(0.2)
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                        task.wait(0.1)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                        task.wait(0.1)
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.BackSlash, false, game)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.BackSlash, false, game)
                        print("Кнопка Replay нажата через VirtualInputManager.")
                        
                        -- Проверяем, было ли Replay успешно нажато
                        if not ReadyScreen.Enabled then
                            print("Replay успешно нажата. Выход из цикла нажатия.")
                            break
                        else
                            print("Replay не была нажата. Продолжаю попытки.")
                        end
                    else
                        print("Кнопка Replay не найдена или неверного типа.")
                    end
                end
                task.wait(0.5) -- Задержка для предотвращения перегрузки
            end
        end
        
        -- Функция для телепортации к мобу и обнуления его здоровья
        local function killDemon()
            print("Функция killDemon запущена.")
            while getgenv().LvlFarm do
                local demon = Workspace.Objects and Workspace.Objects.Mobs and Workspace.Objects.Mobs:FindFirstChild("Heian Imaginary Demon")
                if demon and demon:FindFirstChild("Humanoid") then
                    local humanoid = demon.Humanoid
                    -- Проверяем, есть ли HumanoidRootPart, иначе используем Humanoid's RootPart
                    local demonPos
                    if demon:FindFirstChild("HumanoidRootPart") then
                        demonPos = demon.HumanoidRootPart.Position
                    elseif humanoid and humanoid.RootPart then
                        demonPos = humanoid.RootPart.Position
                    else
                        demonPos = nil
                    end

                    if demonPos then
                        -- Телепортируемся к мобу
                        HumanoidRootPart.CFrame = CFrame.new(demonPos)
                        print("Телепортировался к Heian Imaginary Demon по позиции:", demonPos)
                        
                        -- Устанавливаем здоровье моба в 0
                        humanoid.Health = 0
                        print("Здоровье Heian Imaginary Demon установлено в 0.")
                    else
                        print("Не удалось получить позицию демона.")
                    end
                else
                    print("Демон Heian Imaginary Demon не найден или у него нет Humanoid.")
                end
                task.wait(0.1) -- Задержка перед следующим циклом
            end
        end
        
        -- Функция для телепортации к BossSpawn
        local function teleportToBossSpawn()
            print("Функция teleportToBossSpawn запущена.")
            while getgenv().LvlFarm do
                local BossSpawn = Workspace.Objects.Spawns and Workspace.Objects.Spawns:FindFirstChild("BossSpawn")
                if BossSpawn then
                    HumanoidRootPart.CFrame = CFrame.new(BossSpawn.Position)
                    print("Телепортировался к BossSpawn по позиции:", BossSpawn.Position)
                else
                    print("BossSpawn не найден.")
                end
                task.wait(1) -- Задержка перед следующим проверкой
            end
        end
        
        -- Запускаем все функции параллельно
        task.spawn(pressReplay)
        task.spawn(killDemon)
        task.spawn(teleportToBossSpawn)
    end
end
